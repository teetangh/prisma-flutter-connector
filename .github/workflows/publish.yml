# Publishes the package to pub.dev when a version tag is pushed.
#
# Usage:
#   1. Update version in pubspec.yaml
#   2. Update CHANGELOG.md
#   3. Commit: git commit -m "chore: bump version to X.Y.Z"
#   4. Tag and push: git tag vX.Y.Z && git push origin vX.Y.Z
#
# Prerequisites:
#   1. First version must be published manually: dart pub publish
#   2. Enable automated publishing at: https://pub.dev/packages/prisma_flutter_connector/admin
#   3. Create 'pub.dev' environment in GitHub repo settings
#
# Security:
#   - Uses OIDC authentication (no secrets needed)
#   - Requires 'pub.dev' environment (protection rules apply)
#   - Only triggered by version tags (v*.*.*)

name: Publish to pub.dev

on:
  push:
    tags:
      - 'v[0-9]+.[0-9]+.[0-9]+*'  # v1.0.0, v1.0.0-beta.1, etc.

jobs:
  publish:
    permissions:
      id-token: write  # Required for OIDC authentication with pub.dev
    uses: dart-lang/setup-dart/.github/workflows/publish.yml@v1
    with:
      environment: pub.dev  # Requires GitHub environment protection
